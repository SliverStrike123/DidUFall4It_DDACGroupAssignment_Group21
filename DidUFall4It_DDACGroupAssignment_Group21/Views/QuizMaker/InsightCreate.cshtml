@model DidUFall4It_DDACGroupAssignment_Group21.Models.QuizReview

@{
    ViewData["Title"] = "Create Insight";
    var quizzes = ViewBag.Quizzes as List<DidUFall4It_DDACGroupAssignment_Group21.Models.QuizModel>;
    var attempts = ViewBag.Attempts as List<DidUFall4It_DDACGroupAssignment_Group21.Models.QuizAttempt>;
    var avg = ViewBag.Average as double?;
    var high = ViewBag.Highest as int?;
    var low = ViewBag.Lowest as int?;
    var selectedQuizId = ViewBag.SelectedQuizId as int?;
}

<h1>Create Insight</h1>

<!-- Quiz selection form -->
<form method="get">
    <div class="mb-3">
        <label class="form-label">Select Quiz</label>
        <select name="selectedQuizId" class="form-select" onchange="this.form.submit()">
            <option value="">-- Select Quiz --</option>
            @if (quizzes != null)
            {
                foreach (var quiz in quizzes)
                {
                    <option value="@quiz.QuizModelId" selected="@(selectedQuizId == quiz.QuizModelId ? "selected" : null)">
                        @quiz.Title
                    </option>
                }
            }
        </select>
    </div>
</form>

@if (selectedQuizId != null && attempts != null && attempts.Any())
{
    <div class="mb-3">
        <strong>Average Score:</strong> @avg <br />
        <strong>Highest Score:</strong> @high <br />
        <strong>Lowest Score:</strong> @low <br />
    </div>
    <div class="mb-3">
        <strong>All Attempts:</strong>
        <ul>
            @foreach (var attempt in attempts)
            {
                <li>
                    User: @attempt.UserId, Score: @attempt.Score, Date: @attempt.AttemptDate.ToShortDateString()
                </li>
            }
        </ul>
    </div>

    <!-- Tag input and submit form -->
    <form asp-controller="QuizMaker" asp-action="InsightCreate" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="QuizId" value="@selectedQuizId" />
        <input type="hidden" name="AverageScore" value="@avg" />
        <input type="hidden" name="HighestScore" value="@high" />
        <input type="hidden" name="LowestScore" value="@low" />
        <div class="mb-3">
            <label class="form-label">Tag</label>
            <input name="Tag" class="form-control" required />
        </div>
        <button type="submit" class="btn btn-primary">Save Insight</button>
    </form>
}

<div class="mt-4">
    <a asp-controller="QuizMaker" asp-action="InsightHome" class="btn btn-secondary">Back to Insight Home</a>
</div>